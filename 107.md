NIP-107
======

Nostr Internet of Things 
-----------------------------------

`draft` `optional` `author:benarc` `author:blackcoffeebtc`

## Rationale

The terms/conditions of IoT software/hardware is horrible. A user should be able to message a light or heating and ask it to turn on/off. Nostr gives the simple, permissionless development environment IoT needs.

All communication happens over [NIP04](https://github.com/nostr-protocol/nips/blob/master/04.md).

## Terms

- `user` - user operating IoT devices with NOSTR key-pair and a client made specifically for IoT
- `device` - device to operate over Nostr with NOSTR key-pair, using a microcontroller client like <a href="https://github.com/lnbits/arduino-nostr">nostr-arduino</a>


## Nostr IoT Clients

### User

Where the `user` registers 'device'(s) and its keys, then updates the `device`(s).

### Device

The `device` uses a client like <a href="https://github.com/lnbits/arduino-nostr">nostr-arduino</a> to receive commands from the `user` or another `device`. 
The `device` can also push data such as sensor readings and updates.

## `User` OR `device` registering/updating a `user` OR `device`

A `device` or a `user` can publish these event kinds:
| Kind    |                  | Description                                                                                                   | NIP                                     |
|---------|------------------|---------------------------------------------------------------------------------------------------------------|-----------------------------------------|
| `4    ` | `direct_message` | Communicate between `device`(s) and `user`(s). The messages can be plain-text or JSON. | [NIP04](https://github.com/nostr-protocol/nips/blob/master/04.md) |


### Event: Register a `device`

**Event Content**:
```json
{
    "id": <String, UUID generated by the user.Sequential IDs (`0`, `1`, `2`...) are discouraged>,
    "device_id": <String, UUID of the device>,
    "name": <String, device name>,
    "description": <String (optional), device description>,
    "categories":[ <String (optional), device category, such as 'boiler'>],
    "users":[ [<String (optional), user public-key>]],
}
```

Note:
 - `users`:
   - A list that can restrict access to public-keys, `device`(s) also has keys and can be a `user`.

### Event: Update a `device`

**Event Content**:
```json
{
      "id": <String, UUID generated by the user. Sequential IDs (`0`, `1`, `2`...) are discouraged>,
    "device_id": <String, UUID of the stall to which this device belong to>,
    "settings":[ [<String (optional), user public-key>]]
}
```

Note:
 - `settings`:
   - Standard `settings` include:
   - eg: `[["on", <bool>], ["range", <int, 0-1000>], ["timer_on", <int unix timestamp>], ["timer_off", <int unix timestamp>]]`
  
### Example data types

Below is a non exhaustive list of data types that may be used in the content of the event.


| name              | type    | unit            | example              | description                                                     |
| ----------------- | ------- | --------------- | -------------------- | --------------------------------------------------------------- |
| temperature       | float   | celsius         | 20.9                 | Measures the ambient temperature                                 |
| pressure          | float   | pascals         | 1013                 | Measures the atmospheric pressure                                |
| location          | array   | decimal degrees | [51.5053, -0.08737]  | Specifies coordinates in latitude and longitude                 |
| light             | integer | lux             | 500                  | Measures the intensity of light                                  |
| humidity          | float   | percentage      | 45.5                 | Measures the moisture level in the air                           |
| rain              | boolean | millimeters     | true                 | Detects if it's raining                                          |
| moisture          | float   | percentage      | 32.2                 | Measures the moisture content in materials                       |
| air_quality       | float   | AQI             | 75                   | Measures the overall quality of the air based on pollutants      |
| gas_concentration | float   | ppm             | 400                  | Measures the concentration of a specific gas in the air          |
| uv_index          | float   | index           | 5.5                  | Measures the strength of sunburn-producing ultraviolet radiation |
| wind_speed        | float   | m/s             | 10.2                 | Measures the speed of wind                                       |
| wind_direction    | int  | degrees         | 30         | Indicates the direction from which the wind is coming            |
| sound_intensity   | float   | decibels        | 65.5                 | Measures the loudness or amplitude of sound                      |
